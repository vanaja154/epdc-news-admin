<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EPDC</title>
    <script src="https://kit.fontawesome.com/109a493327.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="header.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
    <style>
        /* Your styles here */
        .btn-primary{
            margin-top: 20px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
<div th:replace="~{header :: header}"></div>

<div class="container mt-4 row">
    <!-- Left Side: Input Forms -->
    <div class="col-md-6">
        <h3>Donation</h3>

        <!-- Single Form for All Updates -->
        <form id="updateForm" method="post" enctype="multipart/form-data">
            <!-- Image -->
            <label class="form-label">Image</label>
            <input type="file" class="form-control" name="image" accept="image/*" />
            <button type="button" onclick="submitForm('image')" class="btn btn-primary">Update</button>
            <div></div>

            <!-- Title -->
            <label class="form-label">Title</label>
            <textarea class="form-control" name="title"></textarea>
            <button type="button" onclick="submitForm('title')" class="btn btn-primary">Update</button>
            <div></div>

            <!-- Text -->
            <label class="form-label">Text</label>
            <textarea class="form-control" name="text"></textarea>
            <button type="button" onclick="submitForm('text')" class="btn btn-primary">Update</button>
            <div></div>

            <!-- Raised Amount -->
            <label class="form-label">Raised Amount</label>
            <input type="number" class="form-control" name="amount" required />
            <button type="button" onclick="submitForm('amount')" class="btn btn-primary">Update</button>
        </form>
    </div>

    <!-- Right Side: Display Data -->
    <div class="col-md-6">
        <h3>Donation</h3>

        <!-- Image -->
        <div>
            <strong>Image:</strong>
            <img th:if="${donationSection.image}" th:src="@{'/uploads/' + ${donationSection.image}}" alt="Image" width="100" />
            <p th:unless="${donationSection.image}">No image available</p>
        </div>
        <div>
            <strong>Title:</strong>
            <p th:text="${donationSection.title} ?: 'No title available'"></p>
        </div>
        <div>
            <strong>Text:</strong>
            <p th:text="${donationSection.text} ?: 'No text available'"></p>
        </div>
        <div>
            <strong>Raised Amount:</strong>
            <p th:text="${donationSection.amount} ?: 'No amount available'"></p>
        </div>
    </div>
</div>

<script>
    function submitForm(fieldName) {
        const form = document.getElementById('updateForm');
        const formData = new FormData(form);

        // Check if the field has a value
        const fieldValue = formData.get(fieldName);
        if (!fieldValue || (fieldValue instanceof File && fieldValue.size === 0)) {
            alert('Please select a file or enter text before updating.');
            return; // Stop execution if the field is empty
        }

        // Only include the field being updated
        const data = new FormData();
        data.append(fieldName, fieldValue);

        // Submit the form data to the backend
        fetch('/updateDonationSection', {
            method: 'POST',
            body: data,
        }).then(response => {
            if (response.ok) {
                alert('Updated successfully!');
                location.reload(); // Reload the page to reflect changes
            } else {
                alert('Failed to update.');
            }
        });
    }
</script>
</body>
</html>